<!DOCTYPE html>
<html lang="en" id="page"><head prefix="og: https://ogp.me/ns# fb: https://ogp.me/ns/fb# article: https://ogp.me/ns/article#"><meta charset="utf-8"/><meta name="viewport" content="width=device-width"/><title>JavaScript inline web workers in Haxe - JavaScript  - Haxe programming language cookbook</title><base href="./../.."/>
<link rel="stylesheet" type="text/css" href="https://haxe.org/css/bootstrap.min.css"/><link rel="stylesheet" type="text/css" href="css/styles.min.css"/><link rel="stylesheet" type="text/css" href="css/haxe-nav.min.css"/><link rel="stylesheet" type="text/css" href="css/fonts.min.css"/><link rel="icon" href="https://haxe.org/favicon.ico"/><link rel="canonical" href="https://code.haxe.org/category/javascript/javascript-inline-workers.html"/><link href="https://code.haxe.org/rss.xml" rel="alternate" type="application/atom+xml" title="RSS Feed Haxe Code Cookbook"/><meta name="description" content="JavaScript workers make it possible to perform costly calculations (media decoding etc, crypt calculations etc.) in a background thread, without blocking the main UI. There are lots of articles about workers on the net:"/>
<meta name="twitter:creator" content="@haxe_org"/>
<meta property="og:title" content="JavaScript inline web workers in Haxe - JavaScript  - Haxe programming language cookbook"/><meta property="og:description" content="JavaScript workers make it possible to perform costly calculations (media decoding etc, crypt calculations etc.) in a background thread, without blocking the main UI. There are lots of articles about workers on the net:"/><meta property="og:type" content="article"/><meta property="og:url" content="https://code.haxe.org/category/javascript/javascript-inline-workers.html"/><meta property="og:image" content="https://code.haxe.org/img/share.png"/><meta property="article:publisher" content="haxe.org"/><meta property="article:published_time" content="2017-11-21 01:01:01"/><meta property="article:modified_time" content="2019-09-17 01:01:01"/><meta property="article:section" content="technology"/><meta property="article:tag" content="javascript,workers,multi-threading"/></head><body><script type="text/javascript">function startsWith(str, searchString){return str.substr(0, searchString.length) === searchString;}if (!startsWith(location.href, "https://code.haxe.org/")) {window.location.replace("https://code.haxe.org/category/javascript/javascript-inline-workers.html");}</script><nav class="section nav dark"><div class="navbar navbar-fixed-top navbar-inverse"><div class="navbar-inner"><button class="btn btn-navbar" data-target=".nav-collapse" data-toggle="collapse" type="button"><span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a class="brand haxe-logo" href="https://haxe.org/"><img alt="Haxe" height="21" onerror="this.src=&#039;https://haxe.org/img/haxe-logo-horizontal-on-dark.png&#039;" src="https://haxe.org/img/haxe-logo-horizontal-on-dark.svg" width="107"/></a><a class="brand sub ide" href="./">CODE</a><div class="nav-collapse collapse"><ul class="nav">
<li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-book"></i> Browse <b class="caret"></b></a><ul class="dropdown-menu"><li><a href="category/beginner/">Beginner <small class="category-count">(21)</small></a></li><li><a href="category/abstract-types/">Abstract types <small class="category-count">(8)</small></a></li><li><a href="category/compilation/">Compilation <small class="category-count">(2)</small></a></li><li><a href="category/data-structures/">Data structures <small class="category-count">(5)</small></a></li><li><a href="category/design-patterns/">Design patterns <small class="category-count">(5)</small></a></li><li><a href="category/functional-programming/">Functional Programming <small class="category-count">(2)</small></a></li><li class="active"><a href="category/javascript/">JavaScript <small class="category-count">(4)</small></a></li><li><a href="category/macros/">Macros <small class="category-count">(20)</small></a></li><li><a href="category/principles/">Principles <small class="category-count">(3)</small></a></li><li><a href="category/other/">Other <small class="category-count">(9)</small></a></li></ul></li><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-tags"></i> Tags <b class="caret"></b></a><ul class="dropdown-menu"><li><a href="tag/expression-macro.html" rel="tag"><i class="fa fa-tag"></i> expression macro <small class="category-count">(11)</small></a></li><li><a href="tag/abstract-type.html" rel="tag"><i class="fa fa-tag"></i> abstract type <small class="category-count">(9)</small></a></li><li><a href="tag/enum.html" rel="tag"><i class="fa fa-tag"></i> enum <small class="category-count">(8)</small></a></li><li><a href="tag/building-fields.html" rel="tag"><i class="fa fa-tag"></i> building fields <small class="category-count">(8)</small></a></li><li><a href="tag/build-macro.html" rel="tag"><i class="fa fa-tag"></i> build macro <small class="category-count">(7)</small></a></li><li><a href="tag/javascript.html" rel="tag"><i class="fa fa-tag"></i> javascript <small class="category-count">(6)</small></a></li><li><a href="tag/pattern-matching.html" rel="tag"><i class="fa fa-tag"></i> pattern matching <small class="category-count">(5)</small></a></li><li><a href="tag/data-structures.html" rel="tag"><i class="fa fa-tag"></i> data structures <small class="category-count">(5)</small></a></li><li><a href="tag/dead-code-elimination.html" rel="tag"><i class="fa fa-tag"></i> dead code elimination <small class="category-count">(4)</small></a></li><li><a href="tag/class.html" rel="tag"><i class="fa fa-tag"></i> class <small class="category-count">(4)</small></a></li><li><a href="tag/iterator.html" rel="tag"><i class="fa fa-tag"></i> iterator <small class="category-count">(4)</small></a></li><li><a href="tag/collections.html" rel="tag"><i class="fa fa-tag"></i> collections <small class="category-count">(4)</small></a></li><li><a href="tag/libraries.html" rel="tag"><i class="fa fa-tag"></i> libraries <small class="category-count">(4)</small></a></li><li><a href="tag/validation.html" rel="tag"><i class="fa fa-tag"></i> validation <small class="category-count">(3)</small></a></li><li><a href="tag/array.html" rel="tag"><i class="fa fa-tag"></i> array <small class="category-count">(3)</small></a></li><li><a href="tag/multi-threading.html" rel="tag"><i class="fa fa-tag"></i> multi threading <small class="category-count">(2)</small></a></li><li><a href="tag/macro.html" rel="tag"><i class="fa fa-tag"></i> macro <small class="category-count">(2)</small></a></li><li><a href="tag/math.html" rel="tag"><i class="fa fa-tag"></i> math <small class="category-count">(2)</small></a></li><li><a href="tag/type-params.html" rel="tag"><i class="fa fa-tag"></i> type params <small class="category-count">(2)</small></a></li><li><a href="tag/static-extension.html" rel="tag"><i class="fa fa-tag"></i> static extension <small class="category-count">(2)</small></a></li><li><a href="tag/json.html" rel="tag"><i class="fa fa-tag"></i> json <small class="category-count">(2)</small></a></li><li><a href="tag/server.html" rel="tag"><i class="fa fa-tag"></i> server <small class="category-count">(2)</small></a></li><li><a href="tag/pipe.html" rel="tag"><i class="fa fa-tag"></i> pipe <small class="category-count">(2)</small></a></li><li><a href="tag/git.html" rel="tag"><i class="fa fa-tag"></i> git <small class="category-count">(2)</small></a></li><li><a href="tag/ereg.html" rel="tag"><i class="fa fa-tag"></i> ereg <small class="category-count">(2)</small></a></li><li><a href="tag/reflection.html" rel="tag"><i class="fa fa-tag"></i> reflection <small class="category-count">(2)</small></a></li><li><a href="tag/arguments.html" rel="tag"><i class="fa fa-tag"></i> arguments <small class="category-count">(2)</small></a></li><li><a href="tag/compiler.html" rel="tag"><i class="fa fa-tag"></i> compiler <small class="category-count">(2)</small></a></li><li><a href="tag/filesystem.html" rel="tag"><i class="fa fa-tag"></i> filesystem <small class="category-count">(2)</small></a></li><li><a href="tag/conditional-compilation.html" rel="tag"><i class="fa fa-tag"></i> conditional compilation <small class="category-count">(2)</small></a></li></ul></li><li class="divider"></li>
<li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="https://haxe.org/documentation/">Learn Haxe <b class="caret"></b></a><ul class="dropdown-menu"><li><a href="https://haxe.org/documentation/introduction/" rel="external nofollow noopener">Introduction</a></li><li><a href="https://haxe.org/manual/" rel="external nofollow noopener">Manual</a></li><li class="active"><a href="https://code.haxe.org" rel="external nofollow noopener">Code Cookbook</a></li><li><a href="https://api.haxe.org" rel="external nofollow noopener">API Documentation</a></li><li class="divider"></li><li><a href="https://haxe.org/videos/" rel="external nofollow noopener">Videos</a></li><li class="divider"></li><li><a href="https://try.haxe.org" rel="external nofollow noopener">Try Haxe online</a></li><li><a href="https://lib.haxe.org" rel="external nofollow noopener">Haxelib</a></li></ul></li><li class=" dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">Connect <b class="caret"></b></a><ul class="dropdown-menu"><li><a href="https://github.com/HaxeFoundation" rel="external nofollow noopener"><i class="fa fa-github"></i> GitHub</a></li><li><a href="https://github.com/HaxeFoundation/haxe/issues" rel="external nofollow noopener"><i class="fa fa-github"></i> Bug reports</a></li><li><a href="https://stackoverflow.com/questions/tagged/haxe" rel="external nofollow noopener"><i class="fa fa-stack-overflow"></i> Stack Overflow</a></li><li><a href="https://community.haxe.org/" rel="external nofollow noopener"><i class="fa fa-envelope-o"></i> Forums</a></li><li><a href="https://discordapp.com/invite/0uEuWH3spjck73Lo" rel="external nofollow"><i class="fa fa-comments-o"></i> Discord</a></li><li><a href="https://gitter.im/HaxeFoundation/haxe" rel="external nofollow"><i class="fa fa-comments-o"></i> Gitter</a></li><li><a href="https://haxe.org/blog"><i class="fa fa-rss"></i> Blog</a></li><li class="divider"></li><li><a href="https://www.facebook.com/haxe.org/" rel="external nofollow noopener"><i class="fa fa-facebook"></i> Facebook</a></li><li><a href="https://twitter.com/search?q=%23haxe" rel="external nofollow noopener"><i class="fa fa-twitter"></i> #haxe</a></li><li><a href="https://twitter.com/haxelang" rel="external nofollow noopener"><i class="fa fa-twitter"></i> @haxelang</a></li><li><a href="https://twitter.com/haxe_org" rel="external nofollow noopener"><i class="fa fa-twitter"></i> @haxe_org</a></li><li class="divider"></li><li><a href="https://haxe.org/foundation/contact.html" rel="external nofollow noopener">Contact</a></li></ul></li></ul></div></div></div></nav><div class="main-content"><header class="hero-unit-small"><div class="container"><div class="row"><div id="title">Haxe Code Cookbook</div></div></div></header><main class="container"><section class="row"><nav class="span4 sidebar-toc" id="sidebar"><h3>Table of contents</h3><ul class="unstyled"><li><a href="category/beginner/">Beginner</a><ul class="unstyled"><li><a href="category/beginner/arrays.html">Using arrays</a></li><li><a href="category/beginner/conditional-compilation.html">Conditional compilation</a></li><li><a href="category/beginner/date-time.html">Working with date and time</a></li><li><a href="category/beginner/declare-classes.html">Declare classes</a></li><li><a href="category/beginner/declare-classes-with-structinit.html">Declare classes using @:structInit</a></li><li><a href="category/beginner/declare-functions.html">Declare functions</a></li><li><a href="category/beginner/enum-adt.html">Using enum / ADT</a></li><li><a href="category/beginner/haxe-to-emscripten-hello-world.html">Haxe to Emscripten</a></li><li><a href="category/beginner/hello-world.html">Hello world</a></li><li><a href="category/beginner/lists.html">Using lists</a></li><li><a href="category/beginner/loading-external-files.html">Loading a file from web</a></li><li><a href="category/beginner/maps.html">Using maps</a></li><li><a href="category/beginner/numbers-floats-ints.html">Using numbers</a></li><li><a href="category/beginner/pattern-matching.html">Pattern matching</a></li><li><a href="category/beginner/reflection-method-call.html">Invoke object method by string</a></li><li><a href="category/beginner/regular-expressions.html">Using regular expressions</a></li><li><a href="category/beginner/stdin-stdout-stderr.html">stdin, stdout, stderr</a></li><li><a href="category/beginner/string-variable-reflection.html">Access a field by string</a></li><li><a href="category/beginner/strings.html">Using strings</a></li><li><a href="category/beginner/using-filesystem.html">Using the file system</a></li><li><a href="category/beginner/using-static-extensions.html">Using static extensions</a></li></ul></li><br/><li><a href="category/abstract-types/">Abstract types</a><ul class="unstyled"><li><a href="category/abstract-types/abstracts-with-type-params.html">Strict typing for stringly-typed extern code</a></li><li><a href="category/abstract-types/array-access-db-manager.html">Array access of a database manager</a></li><li><a href="category/abstract-types/color.html">Color as abstract type</a></li><li><a href="category/abstract-types/emailaddress.html">Email address as abstract type</a></li><li><a href="category/abstract-types/pipe.html">Pipe using Abstract Operator Overloading</a></li><li><a href="category/abstract-types/rounded-float.html">Rounded Float as abstract type</a></li><li><a href="category/abstract-types/temperature-units.html">Temperature units as abstract type</a></li><li><a href="category/abstract-types/using-iterators-as-generic-type-parameters.html">Using Iterators as Generic Type Parameters</a></li></ul></li><br/><li><a href="category/compilation/">Compilation</a><ul class="unstyled"><li><a href="category/compilation/compiling-libraries-without-main-class.html">Compiling libraries without main class</a></li><li><a href="category/compilation/target-specific-modules-diff-by-filename.html">Writing target-specific modules differentiated by filename</a></li></ul></li><br/><li><a href="category/data-structures/">Data structures</a><ul class="unstyled"><li><a href="category/data-structures/grid-iterator.html">Grid iterator</a></li><li><a href="category/data-structures/reverse-iterator.html">Reverse iterator</a></li><li><a href="category/data-structures/ring-array.html">A fixed ring array</a></li><li><a href="category/data-structures/sort-array.html">Sorting arrays</a></li><li><a href="category/data-structures/step-iterator.html">Stepped iterator</a></li></ul></li><br/><li><a href="category/design-patterns/">Design patterns</a><ul class="unstyled"><li><a href="category/design-patterns/factory.html">Factory</a></li><li><a href="category/design-patterns/lazy-initialization.html">Lazy initialization</a></li><li><a href="category/design-patterns/method-chaining-fluent-interface.html">Method chaining / Fluent interface</a></li><li><a href="category/design-patterns/observer.html">Observer</a></li><li><a href="category/design-patterns/singleton.html">Singleton</a></li></ul></li><br/><li><a href="category/functional-programming/">Functional Programming</a><ul class="unstyled"><li><a href="category/functional-programming/enum-gadt.html">Enums as GADTs</a></li><li><a href="category/functional-programming/functional-style-expression-evaluation.html">ML-Style Parse Tree Evaluation</a></li></ul></li><br/><li><a href="category/javascript/" class="active">JavaScript</a><ul class="unstyled"><li><a href="category/javascript/adding-element-to-dom.html">Adding a HTML element to the DOM</a></li><li><a href="category/javascript/creating-node-server.html">Create a server with Haxe/NodeJS</a></li><li class="active"><a href="category/javascript/javascript-inline-workers.html">JavaScript inline web workers in Haxe</a></li><li><a href="category/javascript/using-haxe-classes-in-javascript.html">Using Haxe classes in JavaScript</a></li></ul></li><br/><li><a href="category/macros/">Macros</a><ul class="unstyled"><li><a href="category/macros/add-git-commit-hash-in-build.html">Add git commit-hash in build</a></li><li><a href="category/macros/add-parameters-as-fields.html">Add parameters as fields</a></li><li><a href="category/macros/assert-with-values.html">Assert macro that shows sub-expression values</a></li><li><a href="category/macros/build-arrays.html">Generating Arrays with values</a></li><li><a href="category/macros/build-map.html">Add a map</a></li><li><a href="category/macros/build-property-with-inline-getter.html">Add property with getter</a></li><li><a href="category/macros/build-static-field.html">Add a static field</a></li><li><a href="category/macros/build-value-objects.html">Create value-objects</a></li><li><a href="category/macros/combine-objects.html">Combine two or more structures</a></li><li><a href="category/macros/completion-from-url.html">Code completion from URL</a></li><li><a href="category/macros/enum-abstract-values.html">Get all values of an @:enum abstract</a></li><li><a href="category/macros/extract-enum-value.html">Extract values from known enum instances</a></li><li><a href="category/macros/extract-value-with-pattern-matching.html">Extract values with pattern matching</a></li><li><a href="category/macros/generate-dispatch-code.html">Generate dispatch code</a></li><li><a href="category/macros/generating-code-in-a-macro.html">Add build time using macro</a></li><li><a href="category/macros/get-compiler-define-value.html">Working with compiler flags</a></li><li><a href="category/macros/include-file-next-to-module-file.html">Include a file next to a Haxe module file</a></li><li><a href="category/macros/strictly-typed-json.html">Strictly Typed JSON</a></li><li><a href="category/macros/threading-macro.html">Threading macro like Clojure and pipe operator</a></li><li><a href="category/macros/validate-json.html">Validates a .JSON file compile-time</a></li></ul></li><br/><li><a href="category/principles/">Principles</a><ul class="unstyled"><li><a href="category/principles/everything-is-an-expression.html">Everything is an expression</a></li><li><a href="category/principles/inheritance.html">Inheritance</a></li><li><a href="category/principles/null-safety.html">Null safety</a></li></ul></li><br/><li><a href="category/other/">Other</a><ul class="unstyled"><li><a href="category/other/adding-static-methods-to-existing-classes.html">Adding static methods to existing classes</a></li><li><a href="category/other/base64-encoding.html">Base64 encoding</a></li><li><a href="category/other/compiling-cpp-code-windows-mingw.html">Compiling c++ code on Windows using mingw</a></li><li><a href="category/other/deploy-to-haxelib-using-travis-and-github-releases.html">Publish to Haxelib using Travis and Github Releases</a></li><li><a href="category/other/haxe-zip.html">Zip files</a></li><li><a href="category/other/named-parameters.html">Named Parameters</a></li><li><a href="category/other/passing-different-types-to-a-function-parameter.html">Passing different types to a function parameter</a></li><li><a href="category/other/ssl-socket-server.html">Prototype SSL Socket Server</a></li><li><a href="category/other/vga-text-renderer.html">VGA text renderer</a></li><li><a href="category/other/working-with-cppia/index.html">Working with cppia</a></li></ul></li><br/></ul></nav><article class="span8" itemscope="itemscope" itemtype="https://schema.org/Article"><big class="pull-right"><a href="https://github.com/HaxeFoundation/code-cookbook/edit/master/./assets/content/cookbook/JavaScript/javascript-inline-workers.md?message=Update:%20JavaScript inline web workers in Haxe&amp;description=%0A%0ASources:%0A*%20https://code.haxe.org/category/javascript/javascript-inline-workers.html%0A%0A%40cambiata " title="Edit &#039;JavaScript inline web workers in Haxe&#039; on GitHub" rel="external"><i class="fa fa fa-edit"></i></a></big> <small class="crumb" itemscope="itemscope" itemtype="https://schema.org/BreadcrumbList"><span itemprop="itemListElement" itemscope="itemscope" itemtype="https://schema.org/ListItem"><a itemprop="name" href="/">Haxe programming cookbook</a><meta itemprop="position" content="1"/></span><span itemprop="itemListElement" itemscope="itemscope" itemtype="https://schema.org/ListItem"><a itemprop="name" href="category/javascript/">JavaScript</a><meta itemprop="position" content="2"/></span><span itemprop="itemListElement" itemscope="itemscope" itemtype="https://schema.org/ListItem"><a itemprop="name" href="category/javascript/javascript-inline-workers.html">JavaScript inline web workers in Haxe</a><meta itemprop="position" content="3"/></span></small><h1><a href="https://code.haxe.org/category/javascript/javascript-inline-workers.html" itemprop="url" class="anchorjs-icons"></a> <span itemprop="name">JavaScript inline web workers in Haxe</span></h1><p class="reading-time">Reading time: 5 minutes</p><div itemprop="articleBody"><p>JavaScript workers make it possible to perform costly calculations (media decoding etc, crypt calculations etc.) in a background thread, without blocking the main UI. There are lots of articles about workers on the net:</p><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers">Mozilla MDN - Using web workers</a></li><li><a href="https://www.html5rocks.com/en/tutorials/workers/basics/">Html5Rocks - The basics of web workers</a></li></ul>
<p>Web workers normally require the workers to be defined in separate scripts. This is fully doable using Haxe, but requires a two step compilation process. Using some clever js tricks, we can define the worker code AND the parent code in the same project. This is called "inline workers". You can read more about <a href="https://www.html5rocks.com/en/tutorials/workers/basics/#toc-inlineworkers">JavaScript inline workers here</a>.</p>
<h3>Different inline worker approaches</h3>
<p>Inline workers can be created in different ways. The method that's chosen here uses the same script read twice, once when the page is rendered and one when the worker is instantiated. This has the advantage that the parent and the worker share all dependencies. (Just keep in mind that they run in different threads, and that the worker can't access the DOM.)</p>
<p>Another approach is to create the worker script by using <code>window.URL.createObjectURL</code>. However, it's harder to share dependencies between parent and worker that way.</p>
<p>The solution presented in this example here is inspired by this <a href="http://stackoverflow.com/a/10136565/146400">StackOverflow answer</a> by <a href="http://stackoverflow.com/users/330644/delan-azabani">Delan Azabani</a>.</p>
<h2>Example</h2>
<p>In the following example, the parent will create a 64 Mb data array filled with numbers counting from 0 and up. The data is passed to the worker, wich increments each data item by one and returns it to the parent. (In a real world example, the worker could be doing media decoding, password cracking or some other time-consuming calculations.)</p>
<h3>Creating an inline worker</h3>
<p>Instead of creating a worker by just asking for another external script, the same script that's currently running is read once more. The script identifies itself as running on the parent or on the worker, and initializes differently because of that.</p>
<h3>Processing the data</h3>
<p>The data is passed back and forth between the parent and the worker via messages, and these messages are taken care of in message handlers on each side. In this example, this handler is very simple:</p>
<p>The message passed to the handler is of the type <code>js.html.MessageEvent</code>, and this has a <code>.data</code> property that carries the actual data.</p>
<p>In this example we know that the data is of the type <code>ArrayBuffer</code> so we can just cast it to a <code>Uint8Array</code> and do our simple processing (increasing every array item value by one). Now, we can simply post the altered data back to the parent:</p>
<pre class="highlighted">
<span class="mtk1">    </span><span class="mtk4">// Handle message from parent to worker</span>
<span class="mtk1">    </span><span class="mtk5">static</span><span class="mtk1"> </span><span class="mtk5">function</span><span class="mtk1"> </span><span class="mtk10">onMessageFromParent</span><span class="mtk1">(</span><span class="mtk17">e</span><span class="mtk1">:js.html.</span><span class="mtk9">MessageEvent</span><span class="mtk1">) {</span>
<span class="mtk1">        </span><span class="mtk5">trace</span><span class="mtk1">(</span><span class="mtk7">'Worker received data from Client: '</span><span class="mtk1"> + </span><span class="mtk17">e</span><span class="mtk1">.</span><span class="mtk17">data</span><span class="mtk1">);</span>
<span class="mtk1">        </span><span class="mtk5">var</span><span class="mtk1"> </span><span class="mtk17">uint8View</span><span class="mtk1"> = </span><span class="mtk5">new</span><span class="mtk1"> js.html.</span><span class="mtk9">Uint8Array</span><span class="mtk1">(</span><span class="mtk5">cast</span><span class="mtk1"> </span><span class="mtk17">e</span><span class="mtk1">.</span><span class="mtk17">data</span><span class="mtk1">);</span>
<span class="mtk1">               </span>
<span class="mtk1">        </span><span class="mtk4">// Do fancy stuff with data...</span>
<span class="mtk1">        </span><span class="mtk4">// Here we just add one to each array item</span>
<span class="mtk1">        </span><span class="mtk14">for</span><span class="mtk1"> (</span><span class="mtk17">i</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8">0</span><span class="mtk1"> ... </span><span class="mtk17">uint8View</span><span class="mtk1">.</span><span class="mtk17">length</span><span class="mtk1">) </span><span class="mtk17">uint8View</span><span class="mtk1">[</span><span class="mtk17">i</span><span class="mtk1">] += </span><span class="mtk8">1</span><span class="mtk1">;</span>
<span class="mtk1">      </span>
<span class="mtk1">        </span><span class="mtk4">// Post altered data back to parent</span>
<span class="mtk1">        </span><span class="mtk17">workerScope</span><span class="mtk1">.</span><span class="mtk10">postMessage</span><span class="mtk1">(</span><span class="mtk17">uint8View</span><span class="mtk1">.</span><span class="mtk17">buffer</span><span class="mtk1">, [</span><span class="mtk17">uint8View</span><span class="mtk1">.</span><span class="mtk17">buffer</span><span class="mtk1">]);</span>
<span class="mtk1">    }</span>
</pre>
<h2>Running the example</h2>
<p>The example code below should be saved in a file called <code>Main.hx</code>;
Compile this into a js file called <code>app.js</code> using the following command:</p>
<p><code>haxe -main Main -js app.js -dce full</code></p>
<p>Create a file called <code>index.html</code> with the following content</p>
<pre class="highlighted">
<span class="mtk11">&lt;html&gt;</span>
<span class="mtk1">    </span><span class="mtk11">&lt;head&gt;</span>
<span class="mtk1">    </span><span class="mtk11">&lt;meta</span><span class="mtk1"> </span><span class="mtk12">charset</span><span class="mtk1">=</span><span class="mtk5">"utf-8"</span><span class="mtk1"> </span><span class="mtk11">/&gt;</span>
<span class="mtk1">    </span><span class="mtk11">&lt;title&gt;</span><span class="mtk1">Haxe Inline workers</span><span class="mtk11">&lt;/title&gt;</span>
<span class="mtk1">    </span><span class="mtk11">&lt;/head&gt;</span>
<span class="mtk1">    </span><span class="mtk11">&lt;body&gt;</span>
<span class="mtk1">        </span><span class="mtk11">&lt;script</span><span class="mtk1"> </span><span class="mtk12">src</span><span class="mtk1">=</span><span class="mtk5">"app.js"</span><span class="mtk11">&gt;&lt;</span><span class="mtk1">/</span><span class="mtk11">script&gt;</span>
<span class="mtk1">    </span><span class="mtk11">&lt;/body&gt;</span>
<span class="mtk11">&lt;/html&gt;</span>
</pre>
<p>Open the <code>index.html</code> in a browser window, and check the JavaScript console output.
You should see something like:</p>
<pre><code>&gt; Original data: 0,1,2...  
&gt; Worker received data from Client: [object ArrayBuffer] 
&gt; Parent received data from Worker: [object ArrayBuffer] 
&gt; Roundtrip time: 283 ms  
&gt; Data altered by worker: 1,2,3...</code></pre>
<h2>Note regarding transferrable object data</h2>
<p>In this example, we are using <code>transferrable object</code> to speed up passing the data back and forth between the parent and the worker. Try replacing the <code>postMessage</code> calls in the example code from <code>postMessage(uint8View.buffer, [uint8View.buffer]);</code> to <code>postMessage(uint8View.buffer);</code></p>
<p>This gives you standard object copying, instead of transferrable objects. When you run the example again, you should notice a significant increase in roundtrip time. (On Firefox, this is something like 10x slower)</p>
<p>You can read more about <a href="https://www.html5rocks.com/en/tutorials/workers/basics/#toc-transferrables">transferrable objects here</a>.</p>
<h2>Complete example project code</h2>
<pre class="highlighted">
<span class="mtk4">// Main.hx</span>

<span class="mtk5">class</span><span class="mtk1"> </span><span class="mtk9">Main</span><span class="mtk1"> {</span>

<span class="mtk1">    </span><span class="mtk5">static</span><span class="mtk1"> </span><span class="mtk5">public</span><span class="mtk1"> </span><span class="mtk5">function</span><span class="mtk1"> </span><span class="mtk10">main</span><span class="mtk1">() {</span>
<span class="mtk1">        </span><span class="mtk14">if</span><span class="mtk1"> ( </span><span class="mtk14">try</span><span class="mtk1"> js.</span><span class="mtk9">Browser</span><span class="mtk1">.</span><span class="mtk17">document</span><span class="mtk1"> == </span><span class="mtk5">null</span><span class="mtk1"> </span><span class="mtk14">catch</span><span class="mtk1"> (</span><span class="mtk17">e</span><span class="mtk1">:</span><span class="mtk9">Dynamic</span><span class="mtk1">) </span><span class="mtk5">true</span><span class="mtk1">)              </span>
<span class="mtk1">            </span><span class="mtk10">initAsWorker</span><span class="mtk1">();</span>
<span class="mtk1">        </span><span class="mtk14">else</span><span class="mtk1"> </span>
<span class="mtk1">            </span><span class="mtk10">initAsParent</span><span class="mtk1">();</span>
<span class="mtk1">    }</span>

<span class="mtk1">    </span><span class="mtk4">//=========================================================</span>
<span class="mtk1">    </span><span class="mtk4">// Initialization</span>

<span class="mtk1">    </span><span class="mtk5">static</span><span class="mtk1"> </span><span class="mtk5">var</span><span class="mtk1"> </span><span class="mtk17">workerScope</span><span class="mtk1">:js.html.</span><span class="mtk9">DedicatedWorkerGlobalScope</span><span class="mtk1">;</span>

<span class="mtk1">    </span><span class="mtk5">static</span><span class="mtk1"> </span><span class="mtk5">function</span><span class="mtk1"> </span><span class="mtk10">initAsWorker</span><span class="mtk1">() {</span>
<span class="mtk1">        </span><span class="mtk4">// Find the worker "self"</span>
<span class="mtk1">        </span><span class="mtk17">workerScope</span><span class="mtk1"> = </span><span class="mtk5">untyped</span><span class="mtk1"> </span><span class="mtk17">self</span><span class="mtk1">;</span>

<span class="mtk1">        </span><span class="mtk4">// Setup the worker message handler:        </span>
<span class="mtk1">        </span><span class="mtk17">workerScope</span><span class="mtk1">.</span><span class="mtk17">onmessage</span><span class="mtk1"> = </span><span class="mtk17">onMessageFromParent</span><span class="mtk1">;</span>
<span class="mtk1">    }</span>

<span class="mtk1">    </span><span class="mtk5">static</span><span class="mtk1"> </span><span class="mtk5">function</span><span class="mtk1"> </span><span class="mtk10">initAsParent</span><span class="mtk1">() {</span>
<span class="mtk1">        </span><span class="mtk4">// Find the path of the currently running script</span>
<span class="mtk1">        </span><span class="mtk5">var</span><span class="mtk1"> </span><span class="mtk17">scriptPath</span><span class="mtk1"> = </span><span class="mtk5">cast</span><span class="mtk1">(js.</span><span class="mtk9">Browser</span><span class="mtk1">.</span><span class="mtk17">document</span><span class="mtk1">.</span><span class="mtk17">currentScript</span><span class="mtk1">, js.html.</span><span class="mtk9">ScriptElement</span><span class="mtk1">).</span><span class="mtk17">src</span><span class="mtk1">;        </span>
<span class="mtk1">        </span>
<span class="mtk1">        </span><span class="mtk4">// Create the worker</span>
<span class="mtk1">        </span><span class="mtk5">var</span><span class="mtk1"> </span><span class="mtk17">worker</span><span class="mtk1"> = </span><span class="mtk5">new</span><span class="mtk1"> js.html.</span><span class="mtk9">Worker</span><span class="mtk1">(</span><span class="mtk17">scriptPath</span><span class="mtk1">);</span>

<span class="mtk1">        </span><span class="mtk4">// Setup the parent message handler:</span>
<span class="mtk1">        </span><span class="mtk17">worker</span><span class="mtk1">.</span><span class="mtk17">onmessage</span><span class="mtk1"> = </span><span class="mtk17">onMessageFromWorker</span><span class="mtk1">;        </span>

<span class="mtk1">        </span><span class="mtk4">// create 64Mb data to play with</span>
<span class="mtk1">        </span><span class="mtk5">var</span><span class="mtk1"> </span><span class="mtk17">uint8View</span><span class="mtk1"> = </span><span class="mtk5">new</span><span class="mtk1"> js.html.</span><span class="mtk9">Uint8Array</span><span class="mtk1">(</span><span class="mtk5">new</span><span class="mtk1"> js.html.</span><span class="mtk9">ArrayBuffer</span><span class="mtk1">(</span><span class="mtk8">1024</span><span class="mtk1"> * </span><span class="mtk8">1024</span><span class="mtk1"> * </span><span class="mtk8">64</span><span class="mtk1">));</span>
<span class="mtk1">        </span><span class="mtk14">for</span><span class="mtk1"> (</span><span class="mtk17">i</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8">0</span><span class="mtk1"> ... </span><span class="mtk17">uint8View</span><span class="mtk1">.</span><span class="mtk17">length</span><span class="mtk1">) </span><span class="mtk17">uint8View</span><span class="mtk1">[</span><span class="mtk17">i</span><span class="mtk1">] = </span><span class="mtk17">i</span><span class="mtk1">;</span>
<span class="mtk1">        </span><span class="mtk5">trace</span><span class="mtk1">(</span><span class="mtk7">'Original data: ['</span><span class="mtk1"> + </span><span class="mtk17">uint8View</span><span class="mtk1">.</span><span class="mtk10">subarray</span><span class="mtk1">(</span><span class="mtk8">0</span><span class="mtk1">, </span><span class="mtk8">3</span><span class="mtk1">) + </span><span class="mtk7">'...]'</span><span class="mtk1">);</span>

<span class="mtk1">        </span><span class="mtk17">start</span><span class="mtk1"> = </span><span class="mtk9">Date</span><span class="mtk1">.</span><span class="mtk10">now</span><span class="mtk1">().</span><span class="mtk10">getTime</span><span class="mtk1">();</span>
<span class="mtk1">        </span><span class="mtk17">worker</span><span class="mtk1">.</span><span class="mtk10">postMessage</span><span class="mtk1">(</span><span class="mtk17">uint8View</span><span class="mtk1">.</span><span class="mtk17">buffer</span><span class="mtk1">, [</span><span class="mtk17">uint8View</span><span class="mtk1">.</span><span class="mtk17">buffer</span><span class="mtk1">]);  </span>
<span class="mtk1">    }</span>

<span class="mtk1">    </span><span class="mtk5">static</span><span class="mtk1"> </span><span class="mtk5">var</span><span class="mtk1"> </span><span class="mtk17">start</span><span class="mtk1">:</span><span class="mtk9">Float</span><span class="mtk1"> = </span><span class="mtk8">0</span><span class="mtk1">;</span>

<span class="mtk1">    </span><span class="mtk4">//=========================================================</span>
<span class="mtk1">    </span><span class="mtk4">// Message handlers for processing data</span>

<span class="mtk1">    </span><span class="mtk4">// Handle message passed from parent to worker</span>
<span class="mtk1">    </span><span class="mtk5">static</span><span class="mtk1"> </span><span class="mtk5">function</span><span class="mtk1"> </span><span class="mtk10">onMessageFromParent</span><span class="mtk1">(</span><span class="mtk17">e</span><span class="mtk1">:js.html.</span><span class="mtk9">MessageEvent</span><span class="mtk1">) {</span>
<span class="mtk1">        </span><span class="mtk5">trace</span><span class="mtk1">(</span><span class="mtk7">'Worker received data from Client: '</span><span class="mtk1"> + </span><span class="mtk17">e</span><span class="mtk1">.</span><span class="mtk17">data</span><span class="mtk1">);</span>
<span class="mtk1">        </span><span class="mtk5">var</span><span class="mtk1"> </span><span class="mtk17">uint8View</span><span class="mtk1"> = </span><span class="mtk5">new</span><span class="mtk1"> js.html.</span><span class="mtk9">Uint8Array</span><span class="mtk1">(</span><span class="mtk5">cast</span><span class="mtk1"> </span><span class="mtk17">e</span><span class="mtk1">.</span><span class="mtk17">data</span><span class="mtk1">);</span>
<span class="mtk1">               </span>
<span class="mtk1">        </span><span class="mtk4">// Do fancy stuff with data...</span>
<span class="mtk1">        </span><span class="mtk4">// Here we just add one to each array item</span>
<span class="mtk1">        </span><span class="mtk14">for</span><span class="mtk1"> (</span><span class="mtk17">i</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8">0</span><span class="mtk1"> ... </span><span class="mtk17">uint8View</span><span class="mtk1">.</span><span class="mtk17">length</span><span class="mtk1">) </span><span class="mtk17">uint8View</span><span class="mtk1">[</span><span class="mtk17">i</span><span class="mtk1">] += </span><span class="mtk8">1</span><span class="mtk1">;</span>
<span class="mtk1">      </span>
<span class="mtk1">        </span><span class="mtk4">// Post altered data back to parent</span>
<span class="mtk1">        </span><span class="mtk17">workerScope</span><span class="mtk1">.</span><span class="mtk10">postMessage</span><span class="mtk1">(</span><span class="mtk17">uint8View</span><span class="mtk1">.</span><span class="mtk17">buffer</span><span class="mtk1">, [</span><span class="mtk17">uint8View</span><span class="mtk1">.</span><span class="mtk17">buffer</span><span class="mtk1">]);</span>
<span class="mtk1">    }</span>
<span class="mtk1">    </span>
<span class="mtk1">    </span><span class="mtk4">// Handle message passed from worker to parent</span>
<span class="mtk1">    </span><span class="mtk5">static</span><span class="mtk1"> </span><span class="mtk5">function</span><span class="mtk1"> </span><span class="mtk10">onMessageFromWorker</span><span class="mtk1">(</span><span class="mtk17">e</span><span class="mtk1">:js.html.</span><span class="mtk9">MessageEvent</span><span class="mtk1">) {</span>
<span class="mtk1">        </span><span class="mtk5">trace</span><span class="mtk1">(</span><span class="mtk7">'Parent received data from Worker: '</span><span class="mtk1"> + </span><span class="mtk17">e</span><span class="mtk1">.</span><span class="mtk17">data</span><span class="mtk1">);</span>
<span class="mtk1">        </span><span class="mtk5">trace</span><span class="mtk1">(</span><span class="mtk7">'Roundtrip time: '</span><span class="mtk1"> + (</span><span class="mtk9">Date</span><span class="mtk1">.</span><span class="mtk10">now</span><span class="mtk1">().</span><span class="mtk10">getTime</span><span class="mtk1">() - </span><span class="mtk17">start</span><span class="mtk1">) + </span><span class="mtk7">' ms'</span><span class="mtk1">);            </span>
<span class="mtk1">        </span><span class="mtk5">var</span><span class="mtk1"> </span><span class="mtk17">uint8View</span><span class="mtk1"> = </span><span class="mtk5">new</span><span class="mtk1"> js.html.</span><span class="mtk9">Uint8Array</span><span class="mtk1">(</span><span class="mtk5">cast</span><span class="mtk1"> </span><span class="mtk17">e</span><span class="mtk1">.</span><span class="mtk17">data</span><span class="mtk1">);</span>
<span class="mtk1">        </span><span class="mtk5">trace</span><span class="mtk1">(</span><span class="mtk7">'Data altered by worker: ['</span><span class="mtk1"> + </span><span class="mtk17">uint8View</span><span class="mtk1">.</span><span class="mtk10">subarray</span><span class="mtk1">(</span><span class="mtk8">0</span><span class="mtk1">, </span><span class="mtk8">3</span><span class="mtk1">) + </span><span class="mtk7">'...]'</span><span class="mtk1">);</span>
<span class="mtk1">    }</span>
<span class="mtk1">}</span>

</pre>
</div><hr/><blockquote class="blockquote author-info"><div class="authors row" itemprop="author" itemscope="itemscope" itemtype="https://schema.org/Person"><span class="span2">Author:</span> <div class="span4"><a href="https://github.com/cambiata" rel="external noopener nofollow"><img src="https://github.com/cambiata.png?size=80" loading="lazy" width="40" height="40" title="Jonas Nyström"/></a> <a href="https://github.com/cambiata" itemprop="url" rel="external noopener nofollow" class="author-name"><span itemprop="name">Jonas Nyström</span></a><br/></div> </div> <div class="contributors row"><span class="span2">Contributors:</span> <div class="span4"> <img src="https://www.gravatar.com/avatar/1c049d879db81610b63de27092a714e3.jpg?s=40" loading="lazy" width="20" height="20" title="Gauthier Billot"/> <span class="author-name">Gauthier Billot</span><br/> <img src="https://www.gravatar.com/avatar/09f438359a54f0c4acd2ee4939fe9582.jpg?s=40" loading="lazy" width="20" height="20" title="Valentin Lemière"/> <span class="author-name">Valentin Lemière</span><br/> <img src="https://www.gravatar.com/avatar/7495ab593769f0b51cec8aa260dec79f.jpg?s=40" loading="lazy" width="20" height="20" title="axelmm"/> <span class="author-name">axelmm</span><br/><a href="https://github.com/markknol" rel="external"><img src="https://github.com/markknol.png?size=40" loading="lazy" width="20" height="20" title="Mark Knol"/>  </a><a href="https://github.com/markknol" rel="external nofollow noopener" class="author-name">Mark Knol</a><br/></div> </div><div class="row"><span class="span2">Last modified:</span><time class="span4" datetime="2019-09-17 01:01:01" itemprop="dateModified"><span class="fa fa-clock-o"></span> <a href="https://github.com/HaxeFoundation/code-cookbook/commits/master/./assets/content/cookbook/JavaScript/javascript-inline-workers.md" rel="external">Sep 17, 2019</a></time></div><div class="row semantic"><span class="span2">Created:</span> <time class="span4" datetime="2017-11-21 01:01:01" itemprop="datePublished"><span class="fa fa-clock-o"></span> Nov 21, 2017</time></div><div class="row semantic"><span class="span2">Category:</span> <span class="span4" itemprop="articleSection"><i class="fa fa-book"></i>&nbsp;<a href="category/javascript/">JavaScript</a></span></div><div class="row tags"><span class="span2">Tags:</span> <div class="span4"><span itemprop="keywords"><span class="tag"><i class="fa fa-tag"></i>&nbsp;<a href="tag/javascript.html" rel="tag">javascript</a><i class="semantic">,</i></span><span class="tag"><i class="fa fa-tag"></i>&nbsp;<a href="tag/workers.html" rel="tag">workers</a><i class="semantic">,</i></span><span class="tag"><i class="fa fa-tag"></i>&nbsp;<a href="tag/multi-threading.html" rel="tag">multi-threading</a></span></span></div></div></blockquote><hr/><div class="contribution"><span><i class="fa fa fa-edit"></i> <a href="https://github.com/HaxeFoundation/code-cookbook/edit/master/./assets/content/cookbook/JavaScript/javascript-inline-workers.md?message=Update:%20JavaScript inline web workers in Haxe&amp;description=%0A%0ASources:%0A*%20https://code.haxe.org/category/javascript/javascript-inline-workers.html%0A%0A%40cambiata " title="Edit &#039;JavaScript inline web workers in Haxe&#039; on GitHub" rel="external nofollow noopener">Edit page</a></span>  <span>| <i class="fa fa-plus-circle"></i> <a href="https://github.com/HaxeFoundation/code-cookbook/new/master/./assets/content/cookbook/JavaScript/snippet-name.md/?filename=snippet-name.md" rel="external" title="Add new page in &#039;JavaScript&#039; on Github">Add new page</a></span> </div><hr/><script src="https://utteranc.es/client.js" repo="HaxeFoundation/haxe.org-comments" branch="master" issue-term="[code.haxe.org] JavaScript - JavaScript inline web workers in Haxe" async="async"></script><center class="share-buttons"><a href="https://twitter.com/share" class="twitter-share-button" data-hashtags="haxe" data-size="large" rel="external nofollow noopener">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>&nbsp; 
<div id="fb-root" style="display:inline-block"></div><script>(function(d, s, id) {var js, fjs = d.getElementsByTagName(s)[0];if (d.getElementById(id)) return;js = d.createElement(s); js.id = id;js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";fjs.parentNode.insertBefore(js, fjs);}(document, 'script', 'facebook-jssdk'));</script>
<div class="fb-like" data-href="https://code.haxe.org/category/javascript/javascript-inline-workers.html" style="display:inline-block" data-layout="button_count" data-action="like" data-show-faces="true" data-size="large"></div></center></article></section></main></div><footer class="section dark site-footer"><div class="container"><div class="copyright"><p>&copy;2021&nbsp;<a class="hf-link" href="https://haxe.org/foundation/" rel="external nofollow noopener" title="Haxe Foundation Website">Haxe Foundation</a> |&nbsp;<a href="https://github.com/HaxeFoundation/code-cookbook" title="Haxe Code Cookbook on GitHub" rel="external nofollow noopener">Code Cookbook on GitHub</a> </p><p class="last-modified">Last deploy: May 08, 2021</p></div></div></footer><link rel="stylesheet" type="text/css" href="css/font-awesome.css"/><script defer="defer" src="https://haxe.org/js/jquery.min.js"></script><script defer="defer" src="https://haxe.org/js/bootstrap.min.js"></script><script>  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');  ga('create', 'UA-74262827-2', 'auto');  ga('send', 'pageview');</script></body></html>